@{
    ViewData["Title"] = "Trang quản trị";
}

<h2 class="mb-4">Thống kê</h2>

<!-- Bộ lọc khoảng thời gian -->
<form method="get" class="row g-3 mb-4">
    <div class="col-md-4">
        <label for="fromDate">Từ ngày:</label>
        <input type="date" id="fromDate" name="fromDate" class="form-control" value="@ViewBag.FromDate" />
    </div>
    <div class="col-md-4">
        <label for="toDate">Đến ngày:</label>
        <input type="date" id="toDate" name="toDate" class="form-control" value="@ViewBag.ToDate" />
    </div>
    <div class="col-md-4 d-flex align-items-end">
        <button type="submit" class="btn btn-dark w-100">Áp dụng</button> <!-- Đổi màu nút thành đen -->
    </div>
</form>

<!-- Tổng quan -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card bg-dark text-white shadow"> <!-- Đổi màu box thành đen -->
            <div class="card-body">
                <h5 class="card-title">Tổng số học sinh</h5>
                <p class="display-6">@ViewBag.TotalStudents</p>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-4">
        <div class="card bg-dark text-white shadow"> <!-- Đổi màu box thành đen -->
            <div class="card-body">
                <h5 class="card-title">Tổng số khóa học</h5>
                <p class="display-6">@ViewBag.TotalCourses</p>
            </div>
        </div>
    </div>
</div>
<div class="col-md-6 mb-4">
    <div class="card bg-dark text-white shadow"> <!-- Đổi màu box thành đen -->
        <div class="card-body">
            <h5 class="card-title">Tổng doanh thu trong khoảng thời gian</h5>
            <p class="display-6">@ViewBag.TotalRevenue</p>
        </div>
    </div>
</div>
<!-- Doanh thu theo từng khóa học -->
<div class="mb-4">
    <h5> Doanh thu từng khóa học trong khoảng thời gian đã chọn</h5>
    <ul class="list-group">
        @foreach (var item in ViewBag.RevenueByCourse)
        {
            <li class="list-group-item d-flex justify-content-between align-items-center">
                @item.CourseName
                <span class="badge bg-dark rounded-pill">@item.Revenue nghìn VNĐ</span>
            </li>
        }
    </ul>
</div>


<!-- Biểu đồ doanh thu -->
<div class="mb-4">
    <h5>Biểu đồ doanh thu từng khóa học</h5>
    <canvas id="revenueChart" width="400" height="200"></canvas>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Lấy dữ liệu từ ViewBag
        const courseNames = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
            ((IEnumerable<dynamic>)ViewBag.RevenueByCourse).Select(c => c.CourseName)
        ));
        const revenues = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
            ((IEnumerable<dynamic>)ViewBag.RevenueByCourse).Select(c => c.Revenue)
        ));

        // Vẽ biểu đồ
        const ctx = document.getElementById('revenueChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: courseNames,
                datasets: [{
                    label: 'Doanh thu (nghìn VNĐ)',
                    data: revenues,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
}